apiVersion: 2019-12-01
location: eastus
name: lingolou
properties:
  imageRegistryCredentials:
  - server: lingolou.azurecr.io
    username: lingolou
    password: ${ACR_PASSWORD}
  containers:
  - name: app
    properties:
      image: lingolou.azurecr.io/lingolou-app:latest
      resources:
        requests:
          cpu: 1
          memoryInGb: 1.5
      ports:
      - port: 8000
      environmentVariables:
      - name: DATABASE_URL
        value: sqlite:///./data/lingolou.db
      - name: SESSION_SECRET_KEY
        secureValue: ${SESSION_SECRET_KEY}
      - name: OPENAI_API_KEY
        secureValue: ${OPENAI_API_KEY}
      - name: ELEVENLABS_API_KEY
        secureValue: ${ELEVENLABS_API_KEY}
      - name: GOOGLE_CLIENT_ID
        value: ${GOOGLE_CLIENT_ID}
      - name: GOOGLE_CLIENT_SECRET
        secureValue: ${GOOGLE_CLIENT_SECRET}
      - name: FRONTEND_URL
        value: ${FRONTEND_URL}
      - name: CORS_ORIGINS
        value: ${CORS_ORIGINS}
      - name: STORAGE_BACKEND
        value: local
      volumeMounts:
      - name: data
        mountPath: /app/data
  osType: Linux
  ipAddress:
    type: Public
    dnsNameLabel: lingolou
    ports:
    - protocol: tcp
      port: 8000
  volumes:
  - name: data
    azureFile:
      shareName: lingolou-data
      storageAccountName: ${STORAGE_ACCOUNT_NAME}
      storageAccountKey: ${STORAGE_ACCOUNT_KEY}
type: Microsoft.ContainerInstance/containerGroups
